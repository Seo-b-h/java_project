<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Home</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap-theme.min.css">
    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>

</head>
<a href="/board/list">게시판</a><br/>
<script type="text/javascript">
    $(document).ready(function () {
        $("#logoutBtn").on("click", function () {
            location.href = "member/logout";
        })

        $("#registerBtn").on("click", function () {
            location.href = "member/register";
        })

        $("#memberUpdateBtn").on("click", function () {
            location.href = "member/memberUpdateView";
        })

        $("#memberDeleteBtn").on("click", function () {
            location.href = "member/memberDeleteView";
        })
        $("#submit").on("click", function () {
            if ($("#ID").val() == "") {
                alert("아이디를 입력해주세요.");
                $("#ID").focus();
                return false;
            }

            if ($("#Password").val() == "") {
                alert("비밀번호를 입력해주세요.");
                $("#Password").focus();
                return false;
            }

            $.ajax({
                url: "/member/userChk",
                type: "POST",
                dataType: "json",
                async: false,
                data: $("#homeForm").serializeArray(),
                success: function (data) {
                    if (data === 0) {
                        alert("아이디 혹은 패스워드가 틀렸습니다.");
                    } else {
                        $.ajax({
                            url: "/member/login",
                            type: "POST",
                            dataType: "json",
                            async: false,
                            data: $("#homeForm").serializeArray()
                        })
                        document.location.href = "/board/list";
                    }
                }
            })
        })
    })
</script>
<body>
<form id='homeForm' method="post" action="/member/login">
    <th:block th:if="${session.member == null}">
        <div>
            <label for="ID"></label>
            <input type="text" id="ID" name="ID"/>
        </div>
        <div>
            <label for="Password"></label>
            <input type="password" id="Password" name="Password"/>
        </div>
        <div>
            <button id="submit" type="button">로그인</button>
            <button id="registerBtn" type="button">회원가입</button>
        </div>
    </th:block>
    <th:block th:if="${session.member != null }">
        <div>
            <p th:text="${session.member.ID}+'님 환영 합니다.'"></p>
            <button id="memberUpdateBtn" type="button">회원정보 수정</button>
            <button id="logoutBtn" type="button">로그아웃</button>
            <button id="memberDeleteBtn" type="button">회원 탈퇴</button>
        </div>
    </th:block>
    <th:block th:if="${session.msg == false}">
        <p style="color: red;">로그인 실패! 아이디와 비밀번호 확인해주세요.</p>
    </th:block>
</form>
</body>
</html>